define("orbit_common",["orbit_common/main","orbit_common/cache","orbit_common/schema","orbit_common/source","orbit_common/memory_source"],function(a,b,c,d,e){"use strict";return a.Cache=b,a.Schema=c,a.Source=d,a.MemorySource=e,a}),define("orbit_common/cache",["orbit/lib/objects","orbit/document"],function(a,b){"use strict";var c=a.expose,d=a.isArray,e=function(){this.init.apply(this,arguments)};return e.prototype={constructor:e,init:function(a){this._doc=new b(null,{arrayBasedPaths:!0}),c(this,this._doc,"reset","transform"),this.schema=a;for(var d in a.models)a.models.hasOwnProperty(d)&&this._doc.add([d],{})},length:function(a){var b=this.retrieve(a);return null===b?null:d(b)?b.length:Object.keys(b).length},retrieve:function(a){try{return this._doc.retrieve(a)}catch(b){return null}}},e}),define("orbit_common/lib/exceptions",["exports"],function(a){"use strict";var b=function(a,b){this.type=a,this.record=b};b.prototype={constructor:b};var c=function(a,b){this.type=a,this.record=b};c.prototype={constructor:c},a.RecordNotFoundException=b,a.RecordAlreadyExistsException=c}),define("orbit_common/main",[],function(){"use strict";var a={};return a}),define("orbit_common/memory_source",["orbit/lib/assert","orbit/lib/objects","orbit_common/lib/exceptions","orbit/main","orbit_common/source"],function(a,b,c,d,e){"use strict";var f=a.assert,g=b.extend,h=c.RecordNotFoundException,i=function(){this.init.apply(this,arguments)};return g(i.prototype,e.prototype,{constructor:i,init:function(){f("MemorySource requires Orbit.Promise to be defined",d.Promise),e.prototype.init.apply(this,arguments)},initRecord:function(a,b){this.schema.initRecord(a,b)},_transform:function(a){var b=this._cache.transform(a,!0);this.didTransform(a,b)},_find:function(a,b){var c=this;return new d.Promise(function(d,e){if(void 0===b||"object"==typeof b)d(c._filter.call(c,a,b));else{var f=c.retrieve([a,b]);f?d(f):e(new h(a,b))}})},_filter:function(a,b){var c,d,e,f,g,h=[];c=this.retrieve([a]);for(d in c)if(c.hasOwnProperty(d)){if(g=c[d],void 0===b)f=!0;else{f=!1;for(e in b){if(g[e]!==b[e]){f=!1;break}f=!0}}f&&h.push(g)}return h}}),i}),define("orbit_common/schema",[],function(){"use strict";var a=function(){this.init.apply(this,arguments)};return a.prototype={constructor:a,init:function(a){a=a||{},this.idField=void 0!==a.idField?a.idField:"__id",this.models=void 0!==a.models?a.models:{},a.generateId&&(this.generateId=a.generateId)},initRecord:function(a,b){if(void 0===b[this.idField]){var c=this.models[a],d=c.attributes,e=c.links;if(b[this.idField]=this.generateId(),d)for(var f in d)void 0===b[f]&&d[f].defaultValue&&(b[f]="function"==typeof d[f].defaultValue?d[f].defaultValue.call(b):d[f].defaultValue);if(e){b.links={};for(var g in e)void 0===b.links[g]&&"hasMany"===e[g].type&&(b.links[g]={})}}},generateId:function(){return void 0===this._newId&&(this._newId=0),(new Date).getTime()+"."+(this._newId++).toString()}},a}),define("orbit_common/source",["orbit/lib/assert","orbit/lib/stubs","orbit/lib/objects","orbit/document","orbit/transformable","orbit/requestable","orbit_common/cache"],function(a,b,c,d,e,f,g){"use strict";var h=a.assert,i=b.required,j=c.expose,k=function(){this.init.apply(this,arguments)};return k.prototype={constructor:k,init:function(a,b){h("Source's `schema` must be specified",a),h("Source's `schema.idField` must be specified",a.idField),this.schema=a,b=b||{},this._cache=new g(a),j(this,this._cache,"length","reset","retrieve"),e.extend(this),f.extend(this,["find","add","update","patch","remove","link","unlink"])},initRecord:i,_transform:i,_find:i,_add:function(a,b){this.initRecord(a,b);var c=b[this.schema.idField],d=[a,c],e=this;return this.transform({op:"add",path:d,value:b}).then(function(){return e.retrieve(d)})},_update:function(a,b){this.initRecord(a,b);var c=b[this.schema.idField],d=[a,c],e=this;return this.transform({op:"replace",path:d,value:b}).then(function(){return e.retrieve(d)})},_patch:function(a,b,c,e){if("object"==typeof b){var f=b;this.initRecord(a,f),b=f[this.schema.idField]}return this.transform({op:"replace",path:[a,b].concat(d.prototype.deserializePath(c)),value:e})},_remove:function(a,b){if("object"==typeof b){var c=b;this.initRecord(a,c),b=c[this.schema.idField]}return this.transform({op:"remove",path:[a,b]})},_link:function(a,b,c,d){var e,f=function(a,b,c,d,e){var f=[b,c,"links",d];return"hasMany"===a.type&&(f.push(e),e=!0),{op:"add",path:f,value:e}},g=this.schema.models[a].links[c],h=this;if("object"==typeof b){var i=b;this.initRecord(a,i),b=i[this.schema.idField]}if("object"==typeof d){var j=d;this.initRecord(g.model,j),d=j[this.schema.idField]}if(e=[f(g,a,b,c,d)],g.inverse){var k=this.schema.models[g.model].links[g.inverse];e.push(f(k,g.model,d,g.inverse,b))}return this.transform(e).then(function(){return h.retrieve([a,b])})},_unlink:function(a,b,c,d){var e,f,g,h=function(a,b,c,d,e){var f=[b,c,"links",d];return"hasMany"===a.type&&f.push(e),{op:"remove",path:f}},i=this.schema.models[a].links[c],j=this;if("object"==typeof b&&(f=b,this.initRecord(a,f),b=f[this.schema.idField]),"object"==typeof d&&(g=d,this.initRecord(i.model,g),d=g[this.schema.idField]),e=[h(i,a,b,c,d)],i.inverse){void 0===d&&(void 0===f&&(f=this.retrieve(a,b)),d=f.links[c]);var k=this.schema.models[i.model].links[i.inverse];e.push(h(k,i.model,d,i.inverse,b))}return this.transform(e).then(function(){return j.retrieve([a,b])})}},k}),define("orbit_common",["orbit_common/main","orbit_common/cache","orbit_common/schema","orbit_common/source","orbit_common/memory_source"],function(a,b,c,d,e){"use strict";return a.Cache=b,a.Schema=c,a.Source=d,a.MemorySource=e,a}),define("orbit_common/cache",["orbit/lib/objects","orbit/document"],function(a,b){"use strict";var c=a.expose,d=a.isArray,e=function(){this.init.apply(this,arguments)};return e.prototype={constructor:e,init:function(a){this._doc=new b(null,{arrayBasedPaths:!0}),c(this,this._doc,"reset","transform"),this.schema=a;for(var d in a.models)a.models.hasOwnProperty(d)&&this._doc.add([d],{})},length:function(a){var b=this.retrieve(a);return null===b?null:d(b)?b.length:Object.keys(b).length},retrieve:function(a){try{return this._doc.retrieve(a)}catch(b){return null}}},e}),define("orbit_common/lib/exceptions",["exports"],function(a){"use strict";var b=function(a,b){this.type=a,this.record=b};b.prototype={constructor:b};var c=function(a,b){this.type=a,this.record=b};c.prototype={constructor:c},a.RecordNotFoundException=b,a.RecordAlreadyExistsException=c}),define("orbit_common/main",[],function(){"use strict";var a={};return a}),define("orbit_common/memory_source",["orbit/lib/assert","orbit/lib/objects","orbit_common/lib/exceptions","orbit/main","orbit_common/source"],function(a,b,c,d,e){"use strict";var f=a.assert,g=b.extend,h=c.RecordNotFoundException,i=function(){this.init.apply(this,arguments)};return g(i.prototype,e.prototype,{constructor:i,init:function(){f("MemorySource requires Orbit.Promise to be defined",d.Promise),e.prototype.init.apply(this,arguments)},initRecord:function(a,b){this.schema.initRecord(a,b)},_transform:function(a){var b=this._cache.transform(a,!0);this.didTransform(a,b)},_find:function(a,b){var c=this;return new d.Promise(function(d,e){if(void 0===b||"object"==typeof b)d(c._filter.call(c,a,b));else{var f=c.retrieve([a,b]);f?d(f):e(new h(a,b))}})},_filter:function(a,b){var c,d,e,f,g,h=[];c=this.retrieve([a]);for(d in c)if(c.hasOwnProperty(d)){if(g=c[d],void 0===b)f=!0;else{f=!1;for(e in b){if(g[e]!==b[e]){f=!1;break}f=!0}}f&&h.push(g)}return h}}),i}),define("orbit_common/schema",[],function(){"use strict";var a=function(){this.init.apply(this,arguments)};return a.prototype={constructor:a,init:function(a){a=a||{},this.idField=void 0!==a.idField?a.idField:"__id",this.models=void 0!==a.models?a.models:{},a.generateId&&(this.generateId=a.generateId)},initRecord:function(a,b){if(void 0===b[this.idField]){var c=this.models[a],d=c.attributes,e=c.links;if(b[this.idField]=this.generateId(),d)for(var f in d)void 0===b[f]&&d[f].defaultValue&&(b[f]="function"==typeof d[f].defaultValue?d[f].defaultValue.call(b):d[f].defaultValue);if(e){b.links={};for(var g in e)void 0===b.links[g]&&"hasMany"===e[g].type&&(b.links[g]={})}}},generateId:function(){return void 0===this._newId&&(this._newId=0),(new Date).getTime()+"."+(this._newId++).toString()}},a}),define("orbit_common/source",["orbit/lib/assert","orbit/lib/stubs","orbit/lib/objects","orbit/document","orbit/transformable","orbit/requestable","orbit_common/cache"],function(a,b,c,d,e,f,g){"use strict";var h=a.assert,i=b.required,j=c.expose,k=function(){this.init.apply(this,arguments)};return k.prototype={constructor:k,init:function(a,b){h("Source's `schema` must be specified",a),h("Source's `schema.idField` must be specified",a.idField),this.schema=a,b=b||{},this._cache=new g(a),j(this,this._cache,"length","reset","retrieve"),e.extend(this),f.extend(this,["find","add","update","patch","remove","link","unlink"])},initRecord:i,_transform:i,_find:i,_add:function(a,b){this.initRecord(a,b);var c=b[this.schema.idField],d=[a,c],e=this;return this.transform({op:"add",path:d,value:b}).then(function(){return e.retrieve(d)})},_update:function(a,b){this.initRecord(a,b);var c=b[this.schema.idField],d=[a,c],e=this;return this.transform({op:"replace",path:d,value:b}).then(function(){return e.retrieve(d)})},_patch:function(a,b,c,e){if("object"==typeof b){var f=b;this.initRecord(a,f),b=f[this.schema.idField]}return this.transform({op:"replace",path:[a,b].concat(d.prototype.deserializePath(c)),value:e})},_remove:function(a,b){if("object"==typeof b){var c=b;this.initRecord(a,c),b=c[this.schema.idField]}return this.transform({op:"remove",path:[a,b]})},_link:function(a,b,c,d){var e,f=function(a,b,c,d,e){var f=[b,c,"links",d];return"hasMany"===a.type&&(f.push(e),e=!0),{op:"add",path:f,value:e}},g=this.schema.models[a].links[c],h=this;if("object"==typeof b){var i=b;this.initRecord(a,i),b=i[this.schema.idField]}if("object"==typeof d){var j=d;this.initRecord(g.model,j),d=j[this.schema.idField]}if(e=[f(g,a,b,c,d)],g.inverse){var k=this.schema.models[g.model].links[g.inverse];e.push(f(k,g.model,d,g.inverse,b))}return this.transform(e).then(function(){return h.retrieve([a,b])})},_unlink:function(a,b,c,d){var e,f,g,h=function(a,b,c,d,e){var f=[b,c,"links",d];return"hasMany"===a.type&&f.push(e),{op:"remove",path:f}},i=this.schema.models[a].links[c],j=this;if("object"==typeof b&&(f=b,this.initRecord(a,f),b=f[this.schema.idField]),"object"==typeof d&&(g=d,this.initRecord(i.model,g),d=g[this.schema.idField]),e=[h(i,a,b,c,d)],i.inverse){void 0===d&&(void 0===f&&(f=this.retrieve(a,b)),d=f.links[c]);var k=this.schema.models[i.model].links[i.inverse];e.push(h(k,i.model,d,i.inverse,b))}return this.transform(e).then(function(){return j.retrieve([a,b])})}},k}),function(a){var b,c;!function(){var a={},d={};b=function(b,c,d){a[b]={deps:c,callback:d}},c=function(b){if(d[b])return d[b];d[b]={};var e=a[b];if(!e)throw new Error("Module: '"+b+"' not found.");for(var f,g=e.deps,h=e.callback,i=[],j=0,k=g.length;k>j;j++)i.push("exports"===g[j]?f={}:c(g[j]));var l=h.apply(this,i);return d[b]=f||l},b.registry=a,b.seen=d}(),b("orbit_common",["orbit_common/main","orbit_common/cache","orbit_common/schema","orbit_common/source","orbit_common/memory_source"],function(a,b,c,d,e){"use strict";return a.Cache=b,a.Schema=c,a.Source=d,a.MemorySource=e,a}),b("orbit_common/cache",["orbit/lib/objects","orbit/document"],function(a,b){"use strict";var c=a.expose,d=a.isArray,e=function(){this.init.apply(this,arguments)};return e.prototype={constructor:e,init:function(a){this._doc=new b(null,{arrayBasedPaths:!0}),c(this,this._doc,"reset","transform"),this.schema=a;for(var d in a.models)a.models.hasOwnProperty(d)&&this._doc.add([d],{})},length:function(a){var b=this.retrieve(a);return null===b?null:d(b)?b.length:Object.keys(b).length},retrieve:function(a){try{return this._doc.retrieve(a)}catch(b){return null}}},e}),b("orbit_common/lib/exceptions",["exports"],function(a){"use strict";var b=function(a,b){this.type=a,this.record=b};b.prototype={constructor:b};var c=function(a,b){this.type=a,this.record=b};c.prototype={constructor:c},a.RecordNotFoundException=b,a.RecordAlreadyExistsException=c}),b("orbit_common/main",[],function(){"use strict";var a={};return a}),b("orbit_common/memory_source",["orbit/lib/assert","orbit/lib/objects","orbit_common/lib/exceptions","orbit/main","orbit_common/source"],function(a,b,c,d,e){"use strict";var f=a.assert,g=b.extend,h=c.RecordNotFoundException,i=function(){this.init.apply(this,arguments)};return g(i.prototype,e.prototype,{constructor:i,init:function(){f("MemorySource requires Orbit.Promise to be defined",d.Promise),e.prototype.init.apply(this,arguments)},initRecord:function(a,b){this.schema.initRecord(a,b)},_transform:function(a){var b=this._cache.transform(a,!0);this.didTransform(a,b)},_find:function(a,b){var c=this;return new d.Promise(function(d,e){if(void 0===b||"object"==typeof b)d(c._filter.call(c,a,b));else{var f=c.retrieve([a,b]);f?d(f):e(new h(a,b))}})},_filter:function(a,b){var c,d,e,f,g,h=[];c=this.retrieve([a]);for(d in c)if(c.hasOwnProperty(d)){if(g=c[d],void 0===b)f=!0;else{f=!1;for(e in b){if(g[e]!==b[e]){f=!1;break}f=!0}}f&&h.push(g)}return h}}),i}),b("orbit_common/schema",[],function(){"use strict";var a=function(){this.init.apply(this,arguments)};return a.prototype={constructor:a,init:function(a){a=a||{},this.idField=void 0!==a.idField?a.idField:"__id",this.models=void 0!==a.models?a.models:{},a.generateId&&(this.generateId=a.generateId)},initRecord:function(a,b){if(void 0===b[this.idField]){var c=this.models[a],d=c.attributes,e=c.links;if(b[this.idField]=this.generateId(),d)for(var f in d)void 0===b[f]&&d[f].defaultValue&&(b[f]="function"==typeof d[f].defaultValue?d[f].defaultValue.call(b):d[f].defaultValue);if(e){b.links={};for(var g in e)void 0===b.links[g]&&"hasMany"===e[g].type&&(b.links[g]={})}}},generateId:function(){return void 0===this._newId&&(this._newId=0),(new Date).getTime()+"."+(this._newId++).toString()}},a}),b("orbit_common/source",["orbit/lib/assert","orbit/lib/stubs","orbit/lib/objects","orbit/document","orbit/transformable","orbit/requestable","orbit_common/cache"],function(a,b,c,d,e,f,g){"use strict";var h=a.assert,i=b.required,j=c.expose,k=function(){this.init.apply(this,arguments)};return k.prototype={constructor:k,init:function(a,b){h("Source's `schema` must be specified",a),h("Source's `schema.idField` must be specified",a.idField),this.schema=a,b=b||{},this._cache=new g(a),j(this,this._cache,"length","reset","retrieve"),e.extend(this),f.extend(this,["find","add","update","patch","remove","link","unlink"])},initRecord:i,_transform:i,_find:i,_add:function(a,b){this.initRecord(a,b);var c=b[this.schema.idField],d=[a,c],e=this;return this.transform({op:"add",path:d,value:b}).then(function(){return e.retrieve(d)})},_update:function(a,b){this.initRecord(a,b);var c=b[this.schema.idField],d=[a,c],e=this;return this.transform({op:"replace",path:d,value:b}).then(function(){return e.retrieve(d)})},_patch:function(a,b,c,e){if("object"==typeof b){var f=b;this.initRecord(a,f),b=f[this.schema.idField]}return this.transform({op:"replace",path:[a,b].concat(d.prototype.deserializePath(c)),value:e})},_remove:function(a,b){if("object"==typeof b){var c=b;this.initRecord(a,c),b=c[this.schema.idField]}return this.transform({op:"remove",path:[a,b]})},_link:function(a,b,c,d){var e,f=function(a,b,c,d,e){var f=[b,c,"links",d];return"hasMany"===a.type&&(f.push(e),e=!0),{op:"add",path:f,value:e}},g=this.schema.models[a].links[c],h=this;if("object"==typeof b){var i=b;this.initRecord(a,i),b=i[this.schema.idField]}if("object"==typeof d){var j=d;this.initRecord(g.model,j),d=j[this.schema.idField]}if(e=[f(g,a,b,c,d)],g.inverse){var k=this.schema.models[g.model].links[g.inverse];e.push(f(k,g.model,d,g.inverse,b))}return this.transform(e).then(function(){return h.retrieve([a,b])})},_unlink:function(a,b,c,d){var e,f,g,h=function(a,b,c,d,e){var f=[b,c,"links",d];return"hasMany"===a.type&&f.push(e),{op:"remove",path:f}},i=this.schema.models[a].links[c],j=this;if("object"==typeof b&&(f=b,this.initRecord(a,f),b=f[this.schema.idField]),"object"==typeof d&&(g=d,this.initRecord(i.model,g),d=g[this.schema.idField]),e=[h(i,a,b,c,d)],i.inverse){void 0===d&&(void 0===f&&(f=this.retrieve(a,b)),d=f.links[c]);var k=this.schema.models[i.model].links[i.inverse];e.push(h(k,i.model,d,i.inverse,b))}return this.transform(e).then(function(){return j.retrieve([a,b])})}},k}),a.OC=require("orbit_common")}(window);