define("orbit-common",["orbit-common/main","orbit-common/cache","orbit-common/id-map","orbit-common/schema","orbit-common/source","orbit-common/memory-source","orbit-common/lib/exceptions","exports"],function(a,b,c,d,e,f,g,h){"use strict";var i=a["default"],j=b["default"],k=(c["default"],d["default"]),l=e["default"],m=f["default"],n=g.OperationNotAllowed,o=g.RecordNotFoundException,p=g.LinkNotFoundException,q=g.RecordAlreadyExistsException;i.Cache=j,i.Schema=k,i.Source=l,i.MemorySource=m,i.OperationNotAllowed=n,i.RecordNotFoundException=o,i.LinkNotFoundException=p,i.RecordAlreadyExistsException=q,h["default"]=i}),define("orbit-common/cache",["orbit/document","orbit/evented","orbit/lib/objects","./lib/exceptions","exports"],function(a,b,c,d,e){"use strict";var f=a["default"],g=b["default"],h=(c.expose,c.isArray),i=d.OperationNotAllowed,j=function(){this.init.apply(this,arguments)};j.prototype={constructor:j,init:function(a,b){b=b||{},this.trackChanges=void 0!==b.trackChanges?b.trackChanges:!0,this.trackRevLinks=void 0!==b.trackRevLinks?b.trackRevLinks:!0,this.trackRevLinkChanges=void 0!==b.trackRevLinkChanges?b.trackRevLinkChanges:!1,this._doc=new f(null,{arrayBasedPaths:!0}),g.extend(this),this.schema=a;for(var c in a.models)a.models.hasOwnProperty(c)&&this._registerModel(c);this.schema.on("modelRegistered",this._registerModel,this)},_registerModel:function(a){var b=[a];this.retrieve(b)||this._doc.add(b,{})},reset:function(a){this._doc.reset(a),this.schema.registerAllIds(a)},length:function(a){var b=this.retrieve(a);return null===b?null:h(b)?b.length:Object.keys(b).length},retrieve:function(a){try{return this._doc.retrieve(a)}catch(b){return null}},transform:function(a){var b=a.op,c=a.path;if(c=this._doc.deserializePath(c),"add"!==b&&"remove"!==b&&"replace"!==b)throw new i('Cache#transform requires an "add", "remove" or "replace" operation.');if(c.length<2)throw new i("Cache#transform requires an operation with a path >= 2 segments.");!this.trackRevLinks||"remove"!==b&&"replace"!==b||this._removeRevLinks(c),this._transform(a,this.trackChanges),!this.trackRevLinks||"add"!==b&&"replace"!==b||this._addRevLinks(c,a.value)},_transform:function(a,b){if(b){var c=this._doc.transform(a,!0);this.emit("didTransform",a,c)}else this._doc.transform(a,!1)},_addRevLinks:function(a,b){if(b){var c,d,e=this,f=a[0],g=a[1];if(2===a.length)b.__rel&&Object.keys(b.__rel).forEach(function(a){c=e.schema.models[f].links[a],d=b.__rel[a],"hasMany"===c.type?Object.keys(d).forEach(function(b){e._addRevLink(c,f,g,a,b)}):e._addRevLink(c,f,g,a,d)});else if(a.length>3){var h=a[3];c=e.schema.models[f].links[h],d=5===a.length?a[4]:b,this._addRevLink(c,f,g,h,d)}}},_addRevLink:function(a,b,c,d,e){if(e&&"string"==typeof e){var f=[b,c,"__rel",d];"hasMany"===a.type&&f.push(e),f="/"+f.join("/");var g=[a.model,e,"__rev"],h=this.retrieve(g);h?(g.push(f),h=this.retrieve(g),h||this._transformRef("add",g,!0)):(h={},h[f]=!0,this._transformRef("add",g,h))}},_removeRevLinks:function(a){var b=this.retrieve(a);if(b){var c,d,e=this,f=a[0],g=a[1];if(2===a.length){if(b.__rev){var h;Object.keys(b.__rev).forEach(function(a){a=e._doc.deserializePath(a),h=4===a.length?{op:"replace",path:a,value:null}:{op:"remove",path:a};try{e._transform(h,e.trackChanges)}catch(b){console.log("Cache._transform() exception:",b,"operation:",h)}})}b.__rel&&Object.keys(b.__rel).forEach(function(a){c=e.schema.models[f].links[a],d=b.__rel[a],"hasMany"===c.type?Object.keys(d).forEach(function(b){e._removeRevLink(c,f,g,a,b)}):e._removeRevLink(c,f,g,a,d)})}else if(a.length>3){var i=a[3];c=e.schema.models[f].links[i],d=5===a.length?a[4]:b,this._removeRevLink(c,f,g,i,d)}}},_removeRevLink:function(a,b,c,d,e){if(e&&"string"==typeof e){var f=[b,c,"__rel",d];"hasMany"===a.type&&f.push(e),f="/"+f.join("/");var g=[a.model,e,"__rev",f];this._transformRef("remove",g)}},_transformRef:function(a,b,c){var d={op:a,path:b};c&&(d.value=c);try{this._transform(d,this.trackRevLinkChanges)}catch(e){console.log("Cache._transformRef() exception",e,"for operation",d)}}},e["default"]=j}),define("orbit-common/id-map",["orbit/lib/assert","exports"],function(a,b){"use strict";var c=a.assert,d=function(){this.init.apply(this,arguments)};d.prototype={constructor:d,init:function(a,b){c("IdMap's `idField` must be specified",a),c("IdMap's `remoteIdField` must be specified",b),this.idField=a,this.remoteIdField=b,this.reset()},reset:function(){this._remoteToLocal={},this._localToRemote={}},register:function(a,b,c){if(b&&c){var d=this._remoteToLocal[a];d||(d=this._remoteToLocal[a]={}),d[c]=b;var e=this._localToRemote[a];e||(e=this._localToRemote[a]={}),e[b]=c}},registerAll:function(a){if(a){var b,c,d,e=this;Object.keys(a).forEach(function(f){b=e._remoteToLocal[f],b||(b=e._remoteToLocal[f]={}),c=e._localToRemote[f],c||(c=e._localToRemote[f]={});var g=a[f];Object.keys(g).forEach(function(a){d=g[a][e.remoteIdField],d&&(b[d]=a,c[a]=d)})})}},remoteToLocalId:function(a,b){if(b){var c=this._remoteToLocal[a];if(c)return c[b]}},localToRemoteId:function(a,b){if(b){var c=this._localToRemote[a];if(c)return c[b]}}},b["default"]=d}),define("orbit-common/lib/exceptions",["exports"],function(a){"use strict";var b=function(a){this.description=a};b.prototype={constructor:b};var c=function(a,b){this.type=a,this.record=b};c.prototype={constructor:c};var d=function(a,b,c){this.type=a,this.record=b,this.key=c};d.prototype={constructor:d};var e=function(a,b){this.type=a,this.record=b};e.prototype={constructor:e},a.OperationNotAllowed=b,a.RecordNotFoundException=c,a.LinkNotFoundException=d,a.RecordAlreadyExistsException=e}),define("orbit-common/main",["exports"],function(a){"use strict";var b={};a["default"]=b}),define("orbit-common/memory-source",["orbit/main","orbit/lib/assert","orbit/lib/objects","./source","./lib/exceptions","exports"],function(a,b,c,d,e,f){"use strict";var g=a["default"],h=b.assert,i=c.extend,j=c.isArray,k=c.isNone,l=d["default"],m=e.RecordNotFoundException,n=e.LinkNotFoundException,o=function(){this.init.apply(this,arguments)};i(o.prototype,l.prototype,{constructor:o,init:function(){h("MemorySource requires Orbit.Promise to be defined",g.Promise),l.prototype.init.apply(this,arguments)},_transform:function(a){this._cache.transform(a)},_find:function(a,b){var c,d=this,e=this.schema.idField,f=this.schema.remoteIdField;return new g.Promise(function(g,h){if(k(b))c=d._filter.call(d,a);else if(j(b)){var i,l,n;c=[],n=[];for(var o=0,p=b.length;p>o;o++)l=b[o],i="object"==typeof l&&l[f]?d._filterOne.call(d,a,f,l[f]):d.retrieve([a,l]),i?c.push(i):n.push(l);n.length>0&&(c=null,b=n)}else c="object"==typeof b?b[e]?d.retrieve([a,b[e]]):b[f]?d._filterOne.call(d,a,f,b[f]):d._filter.call(d,a,b):d.retrieve([a,b]);c?g(c):h(new m(a,b))})},_findLink:function(a,b,c){var d,e=this,f=this.schema.idField;return new g.Promise(function(g,h){if(d=e.retrieve("object"==typeof b?[a,b[f]]:[a,b])){var i;if(d.__rel&&(i=d.__rel[c])){var j=e.schema.models[a].links[c],k=j.model;if("hasMany"===j.type){var l,o,p=Object.keys(i);i=[],o=[],p.forEach(function(a){l=e.retrieve([k,a]),l?i.push(l):o.push(l)}),o.length>0&&(i=null)}else i=e.retrieve([k,i])}i?g(i):h(new n(a,b,c))}else h(new m(a,b))})},_filter:function(a,b){var c,d,e,f,g,h=[];c=this.retrieve([a]);for(d in c)if(c.hasOwnProperty(d)){if(g=c[d],void 0===b)f=!0;else{f=!1;for(e in b){if(g[e]!==b[e]){f=!1;break}f=!0}}f&&h.push(g)}return h},_filterOne:function(a,b,c){var d,e,f;d=this.retrieve([a]);for(e in d)if(d.hasOwnProperty(e)&&(f=d[e],f[b]===c))return f}}),f["default"]=o}),define("orbit-common/schema",["orbit/lib/objects","./lib/exceptions","orbit/evented","./id-map","exports"],function(a,b,c,d,e){"use strict";var f=(a.clone,b.OperationNotAllowed),g=c["default"],h=d["default"],i=function(){this.init.apply(this,arguments)};i.prototype={constructor:i,init:function(a){a=a||{},this.idField=void 0!==a.idField?a.idField:"__id",this.remoteIdField=void 0!==a.remoteIdField?a.remoteIdField:"id",this.models=void 0!==a.models?a.models:{},a.generateId&&(this.generateId=a.generateId),this.idField!==this.remoteIdField&&(this._idMap=new h(this.idField,this.remoteIdField)),g.extend(this)},registerModel:function(a,b){this.models[a]=b,this.emit("modelRegistered",a)},normalize:function(a,b){if(b.__normalized)return b;var c=b;if(c.__normalized=!0,this._idMap){var d=c[this.idField],e=c[this.remoteIdField];void 0===d&&(e&&(d=this._idMap.remoteToLocalId(a,e)),d=d||this.generateId(),c[this.idField]=d),this._idMap.register(a,d,e)}else c[this.idField]=c[this.idField]||this.generateId();return c.__rev=c.__rev||{},c.__rel=c.__rel||{},this.initDefaults(a,c),c},initDefaults:function(a,b){if(!b.__normalized)throw new f("Schema.initDefaults requires a normalized record");var c=this.models[a],d=c.attributes,e=c.links;if(d)for(var g in d)void 0===b[g]&&(b[g]=void 0!==d[g].defaultValue?"function"==typeof d[g].defaultValue?d[g].defaultValue.call(b):d[g].defaultValue:null);if(e)for(var h in e)void 0===b.__rel[h]&&(b.__rel[h]="hasMany"===e[h].type?{}:null)},generateId:function(){return void 0===this._newId&&(this._newId=0),(new Date).getTime()+"."+(this._newId++).toString()},remoteToLocalId:function(a,b){return this._idMap?this._idMap.remoteToLocalId(a,b):b},localToRemoteId:function(a,b){return this._idMap?this._idMap.localToRemoteId(a,b):b},registerIds:function(a,b){this._idMap&&this._idMap.register(a,b[this.idField],b[this.remoteIdField])},registerAllIds:function(a){this._idMap&&a&&this._idMap.registerAll(a)},pluralize:function(a){return a+"s"}},e["default"]=i}),define("orbit-common/source",["orbit/document","orbit/transformable","orbit/requestable","orbit/lib/assert","orbit/lib/stubs","orbit/lib/objects","./cache","exports"],function(a,b,c,d,e,f,g,h){"use strict";var i=a["default"],j=b["default"],k=c["default"],l=d.assert,m=e.required,n=f.expose,o=g["default"],p=function(){this.init.apply(this,arguments)};p.prototype={constructor:p,init:function(a,b){l("Source's `schema` must be specified",a),l("Source's `schema.idField` must be specified",a.idField),this.schema=a,b=b||{},this._cache=new o(a),n(this,this._cache,"length","reset","retrieve"),this._cache.on("didTransform",this._cacheDidTransform,this),j.extend(this),k.extend(this,["find","add","update","patch","remove","findLink","addLink","removeLink"])},_transform:m,_find:m,_findLink:m,_add:function(a,b){var c=this.normalize(a,b),d=this.getId(c),e=[a,d],f=this;return this.transform({op:"add",path:e,value:c}).then(function(){return f.retrieve(e)})},_update:function(a,b){var c=this.normalize(a,b),d=this.getId(c),e=[a,d],f=this;return this.transform({op:"replace",path:e,value:c}).then(function(){return f.retrieve(e)})},_patch:function(a,b,c,d){if("object"==typeof b){var e=this.normalize(a,b);b=this.getId(e)}return this.transform({op:"replace",path:[a,b].concat(i.prototype.deserializePath(c)),value:d})},_remove:function(a,b){if("object"==typeof b){var c=this.normalize(a,b);b=this.getId(c)}return this.transform({op:"remove",path:[a,b]})},_addLink:function(a,b,c,d){var e,f=function(a,b,c,d,e){var f=[b,c,"__rel",d];return"hasMany"===a.type&&(f.push(e),e=!0),{op:"add",path:f,value:e}},g=this.schema.models[a].links[c],h=this;if("object"==typeof b){var i=this.normalize(a,b);b=this.getId(i)}if("object"==typeof d){var j=this.normalize(g.model,d);d=this.getId(j)}if(e=[f(g,a,b,c,d)],g.inverse){var k=this.schema.models[g.model].links[g.inverse];e.push(f(k,g.model,d,g.inverse,b))}return this.transform(e).then(function(){return h.retrieve([a,b])})},_removeLink:function(a,b,c,d){var e,f,g=function(a,b,c,d,e){var f=[b,c,"__rel",d];return"hasMany"===a.type&&f.push(e),{op:"remove",path:f}},h=this.schema.models[a].links[c],i=this;if("object"==typeof b&&(f=this.normalize(a,b),b=this.getId(f)),"object"==typeof d){var j=this.normalize(h.model,d);d=this.getId(j)}if(e=[g(h,a,b,c,d)],h.inverse){void 0===d&&(void 0===f&&(f=this.retrieve(a,b)),d=f.__rel[c]);var k=this.schema.models[h.model].links[h.inverse];e.push(g(k,h.model,d,h.inverse,b))}return this.transform(e).then(function(){return i.retrieve([a,b])})},_cacheDidTransform:function(a,b){this.didTransform(a,b)},normalize:function(a,b){return this.schema.normalize(a,b)},initDefaults:function(a,b){return this.schema.initDefaults(a,b)},getId:function(a){return a[this.schema.idField]}},h["default"]=p}),define("orbit-common",["orbit-common/main","orbit-common/cache","orbit-common/id-map","orbit-common/schema","orbit-common/source","orbit-common/memory-source","orbit-common/lib/exceptions","exports"],function(a,b,c,d,e,f,g,h){"use strict";var i=a["default"],j=b["default"],k=(c["default"],d["default"]),l=e["default"],m=f["default"],n=g.OperationNotAllowed,o=g.RecordNotFoundException,p=g.LinkNotFoundException,q=g.RecordAlreadyExistsException;i.Cache=j,i.Schema=k,i.Source=l,i.MemorySource=m,i.OperationNotAllowed=n,i.RecordNotFoundException=o,i.LinkNotFoundException=p,i.RecordAlreadyExistsException=q,h["default"]=i}),define("orbit-common/cache",["orbit/document","orbit/evented","orbit/lib/objects","./lib/exceptions","exports"],function(a,b,c,d,e){"use strict";var f=a["default"],g=b["default"],h=(c.expose,c.isArray),i=d.OperationNotAllowed,j=function(){this.init.apply(this,arguments)};j.prototype={constructor:j,init:function(a,b){b=b||{},this.trackChanges=void 0!==b.trackChanges?b.trackChanges:!0,this.trackRevLinks=void 0!==b.trackRevLinks?b.trackRevLinks:!0,this.trackRevLinkChanges=void 0!==b.trackRevLinkChanges?b.trackRevLinkChanges:!1,this._doc=new f(null,{arrayBasedPaths:!0}),g.extend(this),this.schema=a;for(var c in a.models)a.models.hasOwnProperty(c)&&this._registerModel(c);this.schema.on("modelRegistered",this._registerModel,this)},_registerModel:function(a){var b=[a];this.retrieve(b)||this._doc.add(b,{})},reset:function(a){this._doc.reset(a),this.schema.registerAllIds(a)},length:function(a){var b=this.retrieve(a);return null===b?null:h(b)?b.length:Object.keys(b).length},retrieve:function(a){try{return this._doc.retrieve(a)}catch(b){return null}},transform:function(a){var b=a.op,c=a.path;if(c=this._doc.deserializePath(c),"add"!==b&&"remove"!==b&&"replace"!==b)throw new i('Cache#transform requires an "add", "remove" or "replace" operation.');if(c.length<2)throw new i("Cache#transform requires an operation with a path >= 2 segments.");!this.trackRevLinks||"remove"!==b&&"replace"!==b||this._removeRevLinks(c),this._transform(a,this.trackChanges),!this.trackRevLinks||"add"!==b&&"replace"!==b||this._addRevLinks(c,a.value)},_transform:function(a,b){if(b){var c=this._doc.transform(a,!0);this.emit("didTransform",a,c)}else this._doc.transform(a,!1)},_addRevLinks:function(a,b){if(b){var c,d,e=this,f=a[0],g=a[1];if(2===a.length)b.__rel&&Object.keys(b.__rel).forEach(function(a){c=e.schema.models[f].links[a],d=b.__rel[a],"hasMany"===c.type?Object.keys(d).forEach(function(b){e._addRevLink(c,f,g,a,b)}):e._addRevLink(c,f,g,a,d)});else if(a.length>3){var h=a[3];c=e.schema.models[f].links[h],d=5===a.length?a[4]:b,this._addRevLink(c,f,g,h,d)}}},_addRevLink:function(a,b,c,d,e){if(e&&"string"==typeof e){var f=[b,c,"__rel",d];"hasMany"===a.type&&f.push(e),f="/"+f.join("/");var g=[a.model,e,"__rev"],h=this.retrieve(g);h?(g.push(f),h=this.retrieve(g),h||this._transformRef("add",g,!0)):(h={},h[f]=!0,this._transformRef("add",g,h))}},_removeRevLinks:function(a){var b=this.retrieve(a);if(b){var c,d,e=this,f=a[0],g=a[1];if(2===a.length){if(b.__rev){var h;Object.keys(b.__rev).forEach(function(a){a=e._doc.deserializePath(a),h=4===a.length?{op:"replace",path:a,value:null}:{op:"remove",path:a};try{e._transform(h,e.trackChanges)}catch(b){console.log("Cache._transform() exception:",b,"operation:",h)}})}b.__rel&&Object.keys(b.__rel).forEach(function(a){c=e.schema.models[f].links[a],d=b.__rel[a],"hasMany"===c.type?Object.keys(d).forEach(function(b){e._removeRevLink(c,f,g,a,b)}):e._removeRevLink(c,f,g,a,d)})}else if(a.length>3){var i=a[3];c=e.schema.models[f].links[i],d=5===a.length?a[4]:b,this._removeRevLink(c,f,g,i,d)}}},_removeRevLink:function(a,b,c,d,e){if(e&&"string"==typeof e){var f=[b,c,"__rel",d];"hasMany"===a.type&&f.push(e),f="/"+f.join("/");var g=[a.model,e,"__rev",f];this._transformRef("remove",g)}},_transformRef:function(a,b,c){var d={op:a,path:b};c&&(d.value=c);try{this._transform(d,this.trackRevLinkChanges)}catch(e){console.log("Cache._transformRef() exception",e,"for operation",d)}}},e["default"]=j}),define("orbit-common/id-map",["orbit/lib/assert","exports"],function(a,b){"use strict";var c=a.assert,d=function(){this.init.apply(this,arguments)};d.prototype={constructor:d,init:function(a,b){c("IdMap's `idField` must be specified",a),c("IdMap's `remoteIdField` must be specified",b),this.idField=a,this.remoteIdField=b,this.reset()},reset:function(){this._remoteToLocal={},this._localToRemote={}},register:function(a,b,c){if(b&&c){var d=this._remoteToLocal[a];d||(d=this._remoteToLocal[a]={}),d[c]=b;var e=this._localToRemote[a];e||(e=this._localToRemote[a]={}),e[b]=c}},registerAll:function(a){if(a){var b,c,d,e=this;Object.keys(a).forEach(function(f){b=e._remoteToLocal[f],b||(b=e._remoteToLocal[f]={}),c=e._localToRemote[f],c||(c=e._localToRemote[f]={});var g=a[f];Object.keys(g).forEach(function(a){d=g[a][e.remoteIdField],d&&(b[d]=a,c[a]=d)})})}},remoteToLocalId:function(a,b){if(b){var c=this._remoteToLocal[a];if(c)return c[b]}},localToRemoteId:function(a,b){if(b){var c=this._localToRemote[a];if(c)return c[b]}}},b["default"]=d}),define("orbit-common/lib/exceptions",["exports"],function(a){"use strict";var b=function(a){this.description=a};b.prototype={constructor:b};var c=function(a,b){this.type=a,this.record=b};c.prototype={constructor:c};var d=function(a,b,c){this.type=a,this.record=b,this.key=c};d.prototype={constructor:d};var e=function(a,b){this.type=a,this.record=b};e.prototype={constructor:e},a.OperationNotAllowed=b,a.RecordNotFoundException=c,a.LinkNotFoundException=d,a.RecordAlreadyExistsException=e}),define("orbit-common/main",["exports"],function(a){"use strict";var b={};a["default"]=b}),define("orbit-common/memory-source",["orbit/main","orbit/lib/assert","orbit/lib/objects","./source","./lib/exceptions","exports"],function(a,b,c,d,e,f){"use strict";var g=a["default"],h=b.assert,i=c.extend,j=c.isArray,k=c.isNone,l=d["default"],m=e.RecordNotFoundException,n=e.LinkNotFoundException,o=function(){this.init.apply(this,arguments)};i(o.prototype,l.prototype,{constructor:o,init:function(){h("MemorySource requires Orbit.Promise to be defined",g.Promise),l.prototype.init.apply(this,arguments)},_transform:function(a){this._cache.transform(a)},_find:function(a,b){var c,d=this,e=this.schema.idField,f=this.schema.remoteIdField;return new g.Promise(function(g,h){if(k(b))c=d._filter.call(d,a);else if(j(b)){var i,l,n;c=[],n=[];for(var o=0,p=b.length;p>o;o++)l=b[o],i="object"==typeof l&&l[f]?d._filterOne.call(d,a,f,l[f]):d.retrieve([a,l]),i?c.push(i):n.push(l);n.length>0&&(c=null,b=n)}else c="object"==typeof b?b[e]?d.retrieve([a,b[e]]):b[f]?d._filterOne.call(d,a,f,b[f]):d._filter.call(d,a,b):d.retrieve([a,b]);c?g(c):h(new m(a,b))})},_findLink:function(a,b,c){var d,e=this,f=this.schema.idField;return new g.Promise(function(g,h){if(d=e.retrieve("object"==typeof b?[a,b[f]]:[a,b])){var i;if(d.__rel&&(i=d.__rel[c])){var j=e.schema.models[a].links[c],k=j.model;if("hasMany"===j.type){var l,o,p=Object.keys(i);i=[],o=[],p.forEach(function(a){l=e.retrieve([k,a]),l?i.push(l):o.push(l)}),o.length>0&&(i=null)}else i=e.retrieve([k,i])}i?g(i):h(new n(a,b,c))}else h(new m(a,b))})},_filter:function(a,b){var c,d,e,f,g,h=[];c=this.retrieve([a]);for(d in c)if(c.hasOwnProperty(d)){if(g=c[d],void 0===b)f=!0;else{f=!1;for(e in b){if(g[e]!==b[e]){f=!1;break}f=!0}}f&&h.push(g)}return h},_filterOne:function(a,b,c){var d,e,f;d=this.retrieve([a]);for(e in d)if(d.hasOwnProperty(e)&&(f=d[e],f[b]===c))return f}}),f["default"]=o}),define("orbit-common/schema",["orbit/lib/objects","./lib/exceptions","orbit/evented","./id-map","exports"],function(a,b,c,d,e){"use strict";var f=(a.clone,b.OperationNotAllowed),g=c["default"],h=d["default"],i=function(){this.init.apply(this,arguments)};i.prototype={constructor:i,init:function(a){a=a||{},this.idField=void 0!==a.idField?a.idField:"__id",this.remoteIdField=void 0!==a.remoteIdField?a.remoteIdField:"id",this.models=void 0!==a.models?a.models:{},a.generateId&&(this.generateId=a.generateId),this.idField!==this.remoteIdField&&(this._idMap=new h(this.idField,this.remoteIdField)),g.extend(this)},registerModel:function(a,b){this.models[a]=b,this.emit("modelRegistered",a)},normalize:function(a,b){if(b.__normalized)return b;var c=b;if(c.__normalized=!0,this._idMap){var d=c[this.idField],e=c[this.remoteIdField];void 0===d&&(e&&(d=this._idMap.remoteToLocalId(a,e)),d=d||this.generateId(),c[this.idField]=d),this._idMap.register(a,d,e)}else c[this.idField]=c[this.idField]||this.generateId();return c.__rev=c.__rev||{},c.__rel=c.__rel||{},this.initDefaults(a,c),c},initDefaults:function(a,b){if(!b.__normalized)throw new f("Schema.initDefaults requires a normalized record");var c=this.models[a],d=c.attributes,e=c.links;if(d)for(var g in d)void 0===b[g]&&(b[g]=void 0!==d[g].defaultValue?"function"==typeof d[g].defaultValue?d[g].defaultValue.call(b):d[g].defaultValue:null);if(e)for(var h in e)void 0===b.__rel[h]&&(b.__rel[h]="hasMany"===e[h].type?{}:null)},generateId:function(){return void 0===this._newId&&(this._newId=0),(new Date).getTime()+"."+(this._newId++).toString()},remoteToLocalId:function(a,b){return this._idMap?this._idMap.remoteToLocalId(a,b):b},localToRemoteId:function(a,b){return this._idMap?this._idMap.localToRemoteId(a,b):b},registerIds:function(a,b){this._idMap&&this._idMap.register(a,b[this.idField],b[this.remoteIdField])},registerAllIds:function(a){this._idMap&&a&&this._idMap.registerAll(a)},pluralize:function(a){return a+"s"}},e["default"]=i}),define("orbit-common/source",["orbit/document","orbit/transformable","orbit/requestable","orbit/lib/assert","orbit/lib/stubs","orbit/lib/objects","./cache","exports"],function(a,b,c,d,e,f,g,h){"use strict";var i=a["default"],j=b["default"],k=c["default"],l=d.assert,m=e.required,n=f.expose,o=g["default"],p=function(){this.init.apply(this,arguments)};p.prototype={constructor:p,init:function(a,b){l("Source's `schema` must be specified",a),l("Source's `schema.idField` must be specified",a.idField),this.schema=a,b=b||{},this._cache=new o(a),n(this,this._cache,"length","reset","retrieve"),this._cache.on("didTransform",this._cacheDidTransform,this),j.extend(this),k.extend(this,["find","add","update","patch","remove","findLink","addLink","removeLink"])},_transform:m,_find:m,_findLink:m,_add:function(a,b){var c=this.normalize(a,b),d=this.getId(c),e=[a,d],f=this;return this.transform({op:"add",path:e,value:c}).then(function(){return f.retrieve(e)})},_update:function(a,b){var c=this.normalize(a,b),d=this.getId(c),e=[a,d],f=this;return this.transform({op:"replace",path:e,value:c}).then(function(){return f.retrieve(e)})},_patch:function(a,b,c,d){if("object"==typeof b){var e=this.normalize(a,b);b=this.getId(e)}return this.transform({op:"replace",path:[a,b].concat(i.prototype.deserializePath(c)),value:d})},_remove:function(a,b){if("object"==typeof b){var c=this.normalize(a,b);b=this.getId(c)}return this.transform({op:"remove",path:[a,b]})},_addLink:function(a,b,c,d){var e,f=function(a,b,c,d,e){var f=[b,c,"__rel",d];return"hasMany"===a.type&&(f.push(e),e=!0),{op:"add",path:f,value:e}},g=this.schema.models[a].links[c],h=this;if("object"==typeof b){var i=this.normalize(a,b);b=this.getId(i)}if("object"==typeof d){var j=this.normalize(g.model,d);d=this.getId(j)}if(e=[f(g,a,b,c,d)],g.inverse){var k=this.schema.models[g.model].links[g.inverse];e.push(f(k,g.model,d,g.inverse,b))}return this.transform(e).then(function(){return h.retrieve([a,b])})},_removeLink:function(a,b,c,d){var e,f,g=function(a,b,c,d,e){var f=[b,c,"__rel",d];return"hasMany"===a.type&&f.push(e),{op:"remove",path:f}},h=this.schema.models[a].links[c],i=this;if("object"==typeof b&&(f=this.normalize(a,b),b=this.getId(f)),"object"==typeof d){var j=this.normalize(h.model,d);d=this.getId(j)}if(e=[g(h,a,b,c,d)],h.inverse){void 0===d&&(void 0===f&&(f=this.retrieve(a,b)),d=f.__rel[c]);var k=this.schema.models[h.model].links[h.inverse];e.push(g(k,h.model,d,h.inverse,b))}return this.transform(e).then(function(){return i.retrieve([a,b])})},_cacheDidTransform:function(a,b){this.didTransform(a,b)},normalize:function(a,b){return this.schema.normalize(a,b)},initDefaults:function(a,b){return this.schema.initDefaults(a,b)},getId:function(a){return a[this.schema.idField]}},h["default"]=p}),function(a){var b=a.Orbit.__defineModule__,c=a.Orbit.__requireModule__;b("orbit-common",["orbit-common/main","orbit-common/cache","orbit-common/id-map","orbit-common/schema","orbit-common/source","orbit-common/memory-source","orbit-common/lib/exceptions","exports"],function(a,b,c,d,e,f,g,h){"use strict";var i=a["default"],j=b["default"],k=(c["default"],d["default"]),l=e["default"],m=f["default"],n=g.OperationNotAllowed,o=g.RecordNotFoundException,p=g.LinkNotFoundException,q=g.RecordAlreadyExistsException;i.Cache=j,i.Schema=k,i.Source=l,i.MemorySource=m,i.OperationNotAllowed=n,i.RecordNotFoundException=o,i.LinkNotFoundException=p,i.RecordAlreadyExistsException=q,h["default"]=i}),b("orbit-common/cache",["orbit/document","orbit/evented","orbit/lib/objects","./lib/exceptions","exports"],function(a,b,c,d,e){"use strict";var f=a["default"],g=b["default"],h=(c.expose,c.isArray),i=d.OperationNotAllowed,j=function(){this.init.apply(this,arguments)};j.prototype={constructor:j,init:function(a,b){b=b||{},this.trackChanges=void 0!==b.trackChanges?b.trackChanges:!0,this.trackRevLinks=void 0!==b.trackRevLinks?b.trackRevLinks:!0,this.trackRevLinkChanges=void 0!==b.trackRevLinkChanges?b.trackRevLinkChanges:!1,this._doc=new f(null,{arrayBasedPaths:!0}),g.extend(this),this.schema=a;for(var c in a.models)a.models.hasOwnProperty(c)&&this._registerModel(c);this.schema.on("modelRegistered",this._registerModel,this)},_registerModel:function(a){var b=[a];this.retrieve(b)||this._doc.add(b,{})},reset:function(a){this._doc.reset(a),this.schema.registerAllIds(a)},length:function(a){var b=this.retrieve(a);return null===b?null:h(b)?b.length:Object.keys(b).length},retrieve:function(a){try{return this._doc.retrieve(a)}catch(b){return null}},transform:function(a){var b=a.op,c=a.path;if(c=this._doc.deserializePath(c),"add"!==b&&"remove"!==b&&"replace"!==b)throw new i('Cache#transform requires an "add", "remove" or "replace" operation.');if(c.length<2)throw new i("Cache#transform requires an operation with a path >= 2 segments.");!this.trackRevLinks||"remove"!==b&&"replace"!==b||this._removeRevLinks(c),this._transform(a,this.trackChanges),!this.trackRevLinks||"add"!==b&&"replace"!==b||this._addRevLinks(c,a.value)},_transform:function(a,b){if(b){var c=this._doc.transform(a,!0);this.emit("didTransform",a,c)}else this._doc.transform(a,!1)},_addRevLinks:function(a,b){if(b){var c,d,e=this,f=a[0],g=a[1];if(2===a.length)b.__rel&&Object.keys(b.__rel).forEach(function(a){c=e.schema.models[f].links[a],d=b.__rel[a],"hasMany"===c.type?Object.keys(d).forEach(function(b){e._addRevLink(c,f,g,a,b)}):e._addRevLink(c,f,g,a,d)});else if(a.length>3){var h=a[3];c=e.schema.models[f].links[h],d=5===a.length?a[4]:b,this._addRevLink(c,f,g,h,d)}}},_addRevLink:function(a,b,c,d,e){if(e&&"string"==typeof e){var f=[b,c,"__rel",d];"hasMany"===a.type&&f.push(e),f="/"+f.join("/");var g=[a.model,e,"__rev"],h=this.retrieve(g);h?(g.push(f),h=this.retrieve(g),h||this._transformRef("add",g,!0)):(h={},h[f]=!0,this._transformRef("add",g,h))}},_removeRevLinks:function(a){var b=this.retrieve(a);if(b){var c,d,e=this,f=a[0],g=a[1];if(2===a.length){if(b.__rev){var h;Object.keys(b.__rev).forEach(function(a){a=e._doc.deserializePath(a),h=4===a.length?{op:"replace",path:a,value:null}:{op:"remove",path:a};try{e._transform(h,e.trackChanges)}catch(b){console.log("Cache._transform() exception:",b,"operation:",h)}})}b.__rel&&Object.keys(b.__rel).forEach(function(a){c=e.schema.models[f].links[a],d=b.__rel[a],"hasMany"===c.type?Object.keys(d).forEach(function(b){e._removeRevLink(c,f,g,a,b)}):e._removeRevLink(c,f,g,a,d)})}else if(a.length>3){var i=a[3];c=e.schema.models[f].links[i],d=5===a.length?a[4]:b,this._removeRevLink(c,f,g,i,d)}}},_removeRevLink:function(a,b,c,d,e){if(e&&"string"==typeof e){var f=[b,c,"__rel",d];"hasMany"===a.type&&f.push(e),f="/"+f.join("/");var g=[a.model,e,"__rev",f];this._transformRef("remove",g)}},_transformRef:function(a,b,c){var d={op:a,path:b};c&&(d.value=c);try{this._transform(d,this.trackRevLinkChanges)}catch(e){console.log("Cache._transformRef() exception",e,"for operation",d)}}},e["default"]=j}),b("orbit-common/id-map",["orbit/lib/assert","exports"],function(a,b){"use strict";var c=a.assert,d=function(){this.init.apply(this,arguments)};d.prototype={constructor:d,init:function(a,b){c("IdMap's `idField` must be specified",a),c("IdMap's `remoteIdField` must be specified",b),this.idField=a,this.remoteIdField=b,this.reset()},reset:function(){this._remoteToLocal={},this._localToRemote={}},register:function(a,b,c){if(b&&c){var d=this._remoteToLocal[a];d||(d=this._remoteToLocal[a]={}),d[c]=b;var e=this._localToRemote[a];e||(e=this._localToRemote[a]={}),e[b]=c}},registerAll:function(a){if(a){var b,c,d,e=this;Object.keys(a).forEach(function(f){b=e._remoteToLocal[f],b||(b=e._remoteToLocal[f]={}),c=e._localToRemote[f],c||(c=e._localToRemote[f]={});var g=a[f];Object.keys(g).forEach(function(a){d=g[a][e.remoteIdField],d&&(b[d]=a,c[a]=d)})})}},remoteToLocalId:function(a,b){if(b){var c=this._remoteToLocal[a];if(c)return c[b]}},localToRemoteId:function(a,b){if(b){var c=this._localToRemote[a];if(c)return c[b]}}},b["default"]=d}),b("orbit-common/lib/exceptions",["exports"],function(a){"use strict";var b=function(a){this.description=a};b.prototype={constructor:b};var c=function(a,b){this.type=a,this.record=b};c.prototype={constructor:c};var d=function(a,b,c){this.type=a,this.record=b,this.key=c};d.prototype={constructor:d};var e=function(a,b){this.type=a,this.record=b};e.prototype={constructor:e},a.OperationNotAllowed=b,a.RecordNotFoundException=c,a.LinkNotFoundException=d,a.RecordAlreadyExistsException=e}),b("orbit-common/main",["exports"],function(a){"use strict";var b={};a["default"]=b}),b("orbit-common/memory-source",["orbit/main","orbit/lib/assert","orbit/lib/objects","./source","./lib/exceptions","exports"],function(a,b,c,d,e,f){"use strict";var g=a["default"],h=b.assert,i=c.extend,j=c.isArray,k=c.isNone,l=d["default"],m=e.RecordNotFoundException,n=e.LinkNotFoundException,o=function(){this.init.apply(this,arguments)};i(o.prototype,l.prototype,{constructor:o,init:function(){h("MemorySource requires Orbit.Promise to be defined",g.Promise),l.prototype.init.apply(this,arguments)},_transform:function(a){this._cache.transform(a)},_find:function(a,b){var c,d=this,e=this.schema.idField,f=this.schema.remoteIdField;return new g.Promise(function(g,h){if(k(b))c=d._filter.call(d,a);else if(j(b)){var i,l,n;c=[],n=[];for(var o=0,p=b.length;p>o;o++)l=b[o],i="object"==typeof l&&l[f]?d._filterOne.call(d,a,f,l[f]):d.retrieve([a,l]),i?c.push(i):n.push(l);n.length>0&&(c=null,b=n)}else c="object"==typeof b?b[e]?d.retrieve([a,b[e]]):b[f]?d._filterOne.call(d,a,f,b[f]):d._filter.call(d,a,b):d.retrieve([a,b]);c?g(c):h(new m(a,b))})},_findLink:function(a,b,c){var d,e=this,f=this.schema.idField;return new g.Promise(function(g,h){if(d=e.retrieve("object"==typeof b?[a,b[f]]:[a,b])){var i;if(d.__rel&&(i=d.__rel[c])){var j=e.schema.models[a].links[c],k=j.model;if("hasMany"===j.type){var l,o,p=Object.keys(i);i=[],o=[],p.forEach(function(a){l=e.retrieve([k,a]),l?i.push(l):o.push(l)}),o.length>0&&(i=null)}else i=e.retrieve([k,i])}i?g(i):h(new n(a,b,c))}else h(new m(a,b))})},_filter:function(a,b){var c,d,e,f,g,h=[];c=this.retrieve([a]);for(d in c)if(c.hasOwnProperty(d)){if(g=c[d],void 0===b)f=!0;else{f=!1;for(e in b){if(g[e]!==b[e]){f=!1;break}f=!0}}f&&h.push(g)}return h},_filterOne:function(a,b,c){var d,e,f;d=this.retrieve([a]);for(e in d)if(d.hasOwnProperty(e)&&(f=d[e],f[b]===c))return f
}}),f["default"]=o}),b("orbit-common/schema",["orbit/lib/objects","./lib/exceptions","orbit/evented","./id-map","exports"],function(a,b,c,d,e){"use strict";var f=(a.clone,b.OperationNotAllowed),g=c["default"],h=d["default"],i=function(){this.init.apply(this,arguments)};i.prototype={constructor:i,init:function(a){a=a||{},this.idField=void 0!==a.idField?a.idField:"__id",this.remoteIdField=void 0!==a.remoteIdField?a.remoteIdField:"id",this.models=void 0!==a.models?a.models:{},a.generateId&&(this.generateId=a.generateId),this.idField!==this.remoteIdField&&(this._idMap=new h(this.idField,this.remoteIdField)),g.extend(this)},registerModel:function(a,b){this.models[a]=b,this.emit("modelRegistered",a)},normalize:function(a,b){if(b.__normalized)return b;var c=b;if(c.__normalized=!0,this._idMap){var d=c[this.idField],e=c[this.remoteIdField];void 0===d&&(e&&(d=this._idMap.remoteToLocalId(a,e)),d=d||this.generateId(),c[this.idField]=d),this._idMap.register(a,d,e)}else c[this.idField]=c[this.idField]||this.generateId();return c.__rev=c.__rev||{},c.__rel=c.__rel||{},this.initDefaults(a,c),c},initDefaults:function(a,b){if(!b.__normalized)throw new f("Schema.initDefaults requires a normalized record");var c=this.models[a],d=c.attributes,e=c.links;if(d)for(var g in d)void 0===b[g]&&(b[g]=void 0!==d[g].defaultValue?"function"==typeof d[g].defaultValue?d[g].defaultValue.call(b):d[g].defaultValue:null);if(e)for(var h in e)void 0===b.__rel[h]&&(b.__rel[h]="hasMany"===e[h].type?{}:null)},generateId:function(){return void 0===this._newId&&(this._newId=0),(new Date).getTime()+"."+(this._newId++).toString()},remoteToLocalId:function(a,b){return this._idMap?this._idMap.remoteToLocalId(a,b):b},localToRemoteId:function(a,b){return this._idMap?this._idMap.localToRemoteId(a,b):b},registerIds:function(a,b){this._idMap&&this._idMap.register(a,b[this.idField],b[this.remoteIdField])},registerAllIds:function(a){this._idMap&&a&&this._idMap.registerAll(a)},pluralize:function(a){return a+"s"}},e["default"]=i}),b("orbit-common/source",["orbit/document","orbit/transformable","orbit/requestable","orbit/lib/assert","orbit/lib/stubs","orbit/lib/objects","./cache","exports"],function(a,b,c,d,e,f,g,h){"use strict";var i=a["default"],j=b["default"],k=c["default"],l=d.assert,m=e.required,n=f.expose,o=g["default"],p=function(){this.init.apply(this,arguments)};p.prototype={constructor:p,init:function(a,b){l("Source's `schema` must be specified",a),l("Source's `schema.idField` must be specified",a.idField),this.schema=a,b=b||{},this._cache=new o(a),n(this,this._cache,"length","reset","retrieve"),this._cache.on("didTransform",this._cacheDidTransform,this),j.extend(this),k.extend(this,["find","add","update","patch","remove","findLink","addLink","removeLink"])},_transform:m,_find:m,_findLink:m,_add:function(a,b){var c=this.normalize(a,b),d=this.getId(c),e=[a,d],f=this;return this.transform({op:"add",path:e,value:c}).then(function(){return f.retrieve(e)})},_update:function(a,b){var c=this.normalize(a,b),d=this.getId(c),e=[a,d],f=this;return this.transform({op:"replace",path:e,value:c}).then(function(){return f.retrieve(e)})},_patch:function(a,b,c,d){if("object"==typeof b){var e=this.normalize(a,b);b=this.getId(e)}return this.transform({op:"replace",path:[a,b].concat(i.prototype.deserializePath(c)),value:d})},_remove:function(a,b){if("object"==typeof b){var c=this.normalize(a,b);b=this.getId(c)}return this.transform({op:"remove",path:[a,b]})},_addLink:function(a,b,c,d){var e,f=function(a,b,c,d,e){var f=[b,c,"__rel",d];return"hasMany"===a.type&&(f.push(e),e=!0),{op:"add",path:f,value:e}},g=this.schema.models[a].links[c],h=this;if("object"==typeof b){var i=this.normalize(a,b);b=this.getId(i)}if("object"==typeof d){var j=this.normalize(g.model,d);d=this.getId(j)}if(e=[f(g,a,b,c,d)],g.inverse){var k=this.schema.models[g.model].links[g.inverse];e.push(f(k,g.model,d,g.inverse,b))}return this.transform(e).then(function(){return h.retrieve([a,b])})},_removeLink:function(a,b,c,d){var e,f,g=function(a,b,c,d,e){var f=[b,c,"__rel",d];return"hasMany"===a.type&&f.push(e),{op:"remove",path:f}},h=this.schema.models[a].links[c],i=this;if("object"==typeof b&&(f=this.normalize(a,b),b=this.getId(f)),"object"==typeof d){var j=this.normalize(h.model,d);d=this.getId(j)}if(e=[g(h,a,b,c,d)],h.inverse){void 0===d&&(void 0===f&&(f=this.retrieve(a,b)),d=f.__rel[c]);var k=this.schema.models[h.model].links[h.inverse];e.push(g(k,h.model,d,h.inverse,b))}return this.transform(e).then(function(){return i.retrieve([a,b])})},_cacheDidTransform:function(a,b){this.didTransform(a,b)},normalize:function(a,b){return this.schema.normalize(a,b)},initDefaults:function(a,b){return this.schema.initDefaults(a,b)},getId:function(a){return a[this.schema.idField]}},h["default"]=p}),a.OC=c("orbit-common")}(window);